generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                       Int                      @id @default(autoincrement())
  full_name                String
  username                 String                   @unique
  email                    String                   @unique
  password                 String
  balance                  Decimal                  @default(0) @db.Decimal(10, 2)
  role                     Role                     @default(MEMBER)
  status                   UserStatus               @default(ACTIVE)
  profile_imagekit_url     String?
  apikey                   String?                  @unique
  created_at               DateTime                 @default(now())
  updated_at               DateTime                 @updatedAt
  webhook_url              String?
  deposits                 Deposits[]
  discount_usages          DiscountUsage[]
  notifications            Notification[]
  notification_preferences NotificationPreferences?
  orders                   Order[]
  redeem_used              RedeemUsed[]
  reseller                 Reseller?
  tickets                  Ticket[]
  sessions                 UserSession[]

  @@map("user")
}

model Ticket {
  id         Int            @id @default(autoincrement())
  id_user    Int
  subject    String
  category   String
  status     TicketStatus   @default(OPEN)
  priority   TicketPriority @default(MEDIUM)
  created_at DateTime       @default(now())
  updated_at DateTime       @updatedAt
  messages   Json           @default("[]")
  user       User           @relation(fields: [id_user], references: [id])

  @@map("ticket")
}

model UserSession {
  id          Int      @id @default(autoincrement())
  id_user     Int
  token       String   @unique
  ip_address  String?
  user_agent  String?
  device      String?
  location    String?
  last_active DateTime @default(now())
  created_at  DateTime @default(now())
  user        User     @relation(fields: [id_user], references: [id], onDelete: Cascade)

  @@map("user_session")
}

model NotificationPreferences {
  id                    Int      @id @default(autoincrement())
  id_user               Int      @unique
  email_order_updates   Boolean  @default(true)
  email_deposit_updates Boolean  @default(true)
  email_ticket_updates  Boolean  @default(true)
  email_marketing       Boolean  @default(false)
  created_at            DateTime @default(now())
  updated_at            DateTime @updatedAt
  user                  User     @relation(fields: [id_user], references: [id], onDelete: Cascade)

  @@map("notification_preferences")
}

model Reseller {
  id         Int            @id @default(autoincrement())
  id_user    Int            @unique
  status     ResellerStatus @default(ACTIVE)
  created_at DateTime       @default(now())
  updated_at DateTime       @updatedAt
  user       User           @relation(fields: [id_user], references: [id], onDelete: Cascade)

  @@map("reseller")
}

model Platform {
  id                Int            @id @default(autoincrement())
  name              String
  slug              String         @unique
  icon_imagekit_url String?
  status            PlatformStatus @default(ACTIVE)
  created_at        DateTime       @default(now())
  updated_at        DateTime       @updatedAt
  categories        Category[]

  @@map("platform")
}

model Setting {
  id                   Int      @id @default(autoincrement())
  site_name            String
  favicon_imagekit_url String?
  logo_imagekit_url    String?
  instagram_url        String?
  facebook_url         String?
  email                String?
  phone                String?
  telegram             String?
  imagekit_url         String?
  imagekit_publickey   String?
  imagekit_privatekey  String?
  google_analytic_code String?
  google_search_code   String?
  created_at           DateTime @default(now())
  updated_at           DateTime @updatedAt
  reseller_fee         Decimal  @default(100000) @db.Decimal(10, 2)
  pusher_app_cluster   String?
  pusher_app_id        String?
  pusher_app_key       String?
  pusher_app_secret    String?

  @@map("setting")
}

model Category {
  id          Int            @id @default(autoincrement())
  id_platform Int
  name        String
  status      CategoryStatus @default(ACTIVE)
  created_at  DateTime       @default(now())
  updated_at  DateTime       @updatedAt
  platform    Platform       @relation(fields: [id_platform], references: [id])
  services    Service[]

  @@map("category")
}

model Service {
  id              Int           @id @default(autoincrement())
  id_category     Int
  sid             String?
  id_api_provider Int?
  name            String
  min             Int
  max             Int
  price_api       Decimal       @db.Decimal(10, 4)
  price_sale      Decimal       @db.Decimal(10, 4)
  price_reseller  Decimal       @db.Decimal(10, 4)
  refill          Boolean       @default(false)
  type            ServiceType   @default(DEFAULT)
  status          ServiceStatus @default(ACTIVE)
  note            String?
  created_at      DateTime      @default(now())
  updated_at      DateTime      @updatedAt
  orders          Order[]
  api_provider    ApiProvider?  @relation(fields: [id_api_provider], references: [id])
  category        Category      @relation(fields: [id_category], references: [id])

  @@map("service")
}

model ApiProvider {
  id         Int               @id @default(autoincrement())
  name       String
  code       String            @unique
  url        String
  api_key    String
  balance    Decimal           @default(0) @db.Decimal(10, 4)
  status     ApiProviderStatus @default(ACTIVE)
  created_at DateTime          @default(now())
  updated_at DateTime          @updatedAt
  orders     Order[]
  services   Service[]

  @@map("api_provider")
}

model PaymentGateway {
  id          Int                  @id @default(autoincrement())
  provider    PaymentProvider
  api_config  Json
  status      PaymentGatewayStatus @default(ACTIVE)
  min_deposit Decimal              @db.Decimal(10, 2)
  created_at  DateTime             @default(now())
  updated_at  DateTime             @updatedAt

  @@map("payment_gateway")
}

model Order {
  id              Int             @id @default(autoincrement())
  id_user         Int
  id_api_provider Int?
  id_service      Int
  link            String
  price_api       Decimal         @db.Decimal(10, 4)
  price_sale      Decimal         @db.Decimal(10, 4)
  price_seller    Decimal         @db.Decimal(10, 4)
  remains         Int?
  start_count     Int?
  quantity        Int
  status          OrderStatus     @default(PENDING)
  refill          Boolean         @default(false)
  runs            Int?
  interval        Int?
  created_at      DateTime        @default(now())
  updated_at      DateTime        @updatedAt
  invoice_number  String          @unique
  pid             String?
  discount_usages DiscountUsage[]
  api_provider    ApiProvider?    @relation(fields: [id_api_provider], references: [id])
  service         Service         @relation(fields: [id_service], references: [id])
  user            User            @relation(fields: [id_user], references: [id])

  @@map("order")
}

model Deposits {
  id                 Int           @id @default(autoincrement())
  id_user            Int
  amount             Decimal       @db.Decimal(10, 2)
  detail_transaction Json
  status             DepositStatus @default(PENDING)
  created_at         DateTime      @default(now())
  updated_at         DateTime      @updatedAt
  user               User          @relation(fields: [id_user], references: [id])

  @@map("deposits")
}

model News {
  id         Int        @id @default(autoincrement())
  subject    String
  content    String
  status     NewsStatus @default(ACTIVE)
  created_at DateTime   @default(now())
  updated_at DateTime   @updatedAt

  @@map("news")
}

model Discount {
  id               Int             @id @default(autoincrement())
  name_discount    String
  min_transaction  Decimal         @db.Decimal(10, 2)
  max_transaction  Decimal         @db.Decimal(10, 2)
  type             DiscountType
  amount           Decimal         @db.Decimal(10, 2)
  expired_date     DateTime
  max_used         Int
  status           DiscountStatus  @default(ACTIVE)
  created_at       DateTime        @default(now())
  updated_at       DateTime        @updatedAt
  discount_max_get Decimal         @default(0) @db.Decimal(10, 2)
  discount_usages  DiscountUsage[]

  @@map("discount")
}

model DiscountUsage {
  id          Int      @id @default(autoincrement())
  id_discount Int
  id_users    Int
  id_order    Int?
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  discount    Discount @relation(fields: [id_discount], references: [id])
  order       Order?   @relation(fields: [id_order], references: [id])
  user        User     @relation(fields: [id_users], references: [id])

  @@map("discount_usage")
}

model RedeemCode {
  id           Int          @id @default(autoincrement())
  name_code    String       @unique
  quota        Int
  expired_date DateTime
  get_balance  Decimal      @db.Decimal(10, 2)
  total_info   String?
  created_at   DateTime     @default(now())
  updated_at   DateTime     @updatedAt
  status       RedeemStatus @default(ACTIVE)
  used_by      RedeemUsed[]

  @@map("reedem_code")
}

model RedeemUsed {
  id             Int        @id @default(autoincrement())
  id_user        Int
  created_at     DateTime   @default(now())
  updated_at     DateTime   @updatedAt
  id_redeem_code Int
  redeem_code    RedeemCode @relation(fields: [id_redeem_code], references: [id])
  user           User       @relation(fields: [id_user], references: [id])

  @@map("reedem_used")
}

model Notification {
  id         Int              @id @default(autoincrement())
  id_user    Int
  title      String
  message    String
  type       NotificationType
  is_read    Boolean          @default(false)
  related_id Int?
  created_at DateTime         @default(now())
  user       User             @relation(fields: [id_user], references: [id], onDelete: Cascade)

  @@map("notification")
}

model AdminNotification {
  id         Int                   @id @default(autoincrement())
  title      String
  message    String
  type       AdminNotificationType
  is_read    Boolean               @default(false)
  related_id Int?
  created_at DateTime              @default(now())

  @@map("admin_notification")
}

enum Role {
  MEMBER
  STAFF
  ADMIN
}

enum UserStatus {
  ACTIVE
  INACTIVE
}

enum ResellerStatus {
  ACTIVE
  NOT_ACTIVE
}

enum PlatformStatus {
  ACTIVE
  NOT_ACTIVE
}

enum CategoryStatus {
  ACTIVE
  NOT_ACTIVE
}

enum ServiceType {
  DEFAULT
  PACKAGE
  CUSTOM_COMMENTS
  POLL
  SUBSCRIPTIONS
}

enum ServiceStatus {
  ACTIVE
  NOT_ACTIVE
}

enum ApiProviderStatus {
  ACTIVE
  NOT_ACTIVE
}

enum PaymentProvider {
  PAYPAL
  CRYPTOMUS
  MANUAL
}

enum PaymentGatewayStatus {
  ACTIVE
  NOT_ACTIVE
}

enum OrderStatus {
  PENDING
  IN_PROGRESS
  PROCESSING
  COMPLETED
  SUCCESS
  PARTIAL
  ERROR
  CANCELED
}

enum DepositStatus {
  PENDING
  ERROR
  CANCELED
  PAYMENT
}

enum NewsStatus {
  ACTIVE
  NOT_ACTIVE
}

enum DiscountType {
  PERCENTAGE
  FIXED
}

enum DiscountStatus {
  ACTIVE
  NOT_ACTIVE
}

enum TicketStatus {
  OPEN
  PENDING
  ANSWERED
  CLOSED
}

enum TicketPriority {
  HIGH
  MEDIUM
  LOW
}

enum NotificationType {
  ORDER
  DEPOSIT
  TICKET
  SYSTEM
}

enum AdminNotificationType {
  NEW_USER
  NEW_ORDER
  ORDER_UPDATE
  NEW_DEPOSIT
  DEPOSIT_UPDATE
  NEW_TICKET
  TICKET_UPDATE
  SYSTEM
}

enum RedeemStatus {
  ACTIVE
  NOT_ACTIVE
}
